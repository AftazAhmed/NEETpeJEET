<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>NEET-PYQ</title>
  <style>
    body {
      font-family: 'Montserrat', Arial, sans-serif;
      margin: 0;
      padding: 20px 24px;
      background-color: #f9fafb;
      color: #1f2937;
      overflow-x: hidden;
    }
    
    .header {
      text-align: left;
      background-color: #023047;
      color: #ffb347;
      padding: 48px 24px 32px 24px;
      border-radius: 10px;
      margin-bottom: 32px;
      position: relative;
      overflow: hidden;
    }
    
    .header::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at center, #4f59b0 0%, transparent 70%);
      opacity: 0.3;
      pointer-events: none;
    }
    
    .header h1 {
      position: relative;
      margin: 0 0 12px 0;
      font-size: 3rem;
      font-weight: 900;
      letter-spacing: 2px;
      line-height: 1.1;
      transform: none !important;
      color: #ffa726;
      max-width: 100%;
      white-space: nowrap;
    }
    
    .header .subtitle {
      position: relative;
      font-size: 18px;
      font-weight: 600;
      color: #b9fbc0;
      letter-spacing: 0.6px;
    }
    
    .note {
      max-width: 720px;
      margin: 0 auto 24px auto;
      font-style: italic;
      font-size: 14px;
      color: #4b6650;
      background-color: #d7e7d0;
      border-left: 6px solid #a8c77a;
      padding: 12px 20px;
      border-radius: 8px;
    }
    
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 18px;
      margin-bottom: 16px;
      justify-content: center;
      align-items: center;
    }
    
    .class-reload-group {
      display: flex;
      gap: 8px;
      align-items: flex-end;
      min-width: 180px;
      flex: 1;
    }
    
    .dropdown-group {
      min-width: 180px;
      flex: 1;
    }
    
    .class-dropdown-part {
      flex: 1;
    }
    
    label {
      display: block;
      font-weight: 700;
      font-size: 15px;
      margin-bottom: 6px;
      color: #344e41;
    }
    
    select {
      width: 100%;
      padding: 10px 14px;
      border-radius: 8px;
      border: 2px solid #028090;
      font-size: 15px;
      background-color: #ffffff;
      color: #023047;
      transition: 0.3s;
    }
    
    select:focus {
      outline: none;
      border-color: #023047;
      background-color: #e0f7f4;
    }
    
    .reload-btn {
      cursor: pointer;
      background-color: #8b5cf6;
      border: none;
      color: #fff;
      padding: 8px 12px;
      border-radius: 6px;
      font-weight: 700;
      font-size: 12px;
      transition: background-color 0.3s ease;
      display: flex;
      align-items: center;
      gap: 4px;
      height: 36px;
      white-space: nowrap;
    }
    
    .reload-btn:hover {
      background-color: #7c3aed;
    }
    
    #scoreWrapper {
      display: flex;
      align-items: center;
      margin-left: 12px;
    }
    
    #scoreCard {
      display: flex;
      align-items: center;
      font-weight: 700;
      font-size: 18px;
      color: #116466;
      border-left: 5px solid #028090;
      padding-left: 14px;
      white-space: nowrap;
    }
    
    .refreshBtn {
      cursor: pointer;
      background-color: #0d6efd;
      border: none;
      color: #fff;
      padding: 4px 10px;
      border-radius: 7px;
      font-weight: 700;
      font-size: 13px;
      transition: background-color 0.3s ease;
      margin-left: 8px;
      height: 32px;
      line-height: 24px;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .refreshBtn:hover {
      background-color: #084298;
    }
    
    .content-area {
      background-color: #fff1e0;
      padding: 28px 30px;
      border-radius: 12px;
      min-height: 300px;
      color: #1f2937;
      transition: background-color 0.4s ease;
      max-width: 900px;
      margin: 0 auto 30px auto;
    }
    
    .question-count {
      font-weight: 700;
      font-size: 18px;
      color: #116466;
      margin-bottom: 18px;
      border-left: 5px solid #028090;
      padding-left: 14px;
    }
    
    .question-item {
      background-color: #fff8f0;
      border-radius: 12px;
      border: 1.5px solid #f0c49c;
      margin-bottom: 26px;
      padding: 20px 24px;
      font-size: 15px;
      line-height: 1.6;
      word-wrap: break-word;
      max-width: 100%;
      position: relative;
    }
    
    .question-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
      gap: 12px;
      flex-wrap: wrap;
    }
    
    .question-number {
      font-weight: 700;
      font-size: 18px;
      color: #2a6f62;
    }
    
    .question-year {
      background-color: #116466;
      color: #e0f7f4;
      padding: 5px 14px;
      border-radius: 16px;
      font-weight: 600;
      font-size: 13px;
      letter-spacing: 0.6px;
      white-space: nowrap;
    }
    
    .question-text {
      font-weight: 600;
      font-size: 15px;
      color: #255c4d;
      margin-bottom: 14px;
      max-width: 100%;
      word-wrap: break-word;
      word-break: break-word;
    }
    
    .options {
      margin-bottom: 18px;
    }
    
    .option {
      background-color: #ffffff;
      border-radius: 6px;
      border: 1.8px solid #b5d0c8;
      padding: 11px 18px;
      margin: 8px 0;
      font-weight: 500;
      font-size: 15px;
      color: #244636;
      cursor: pointer;
      transition: background-color 0.3s, border-color 0.3s, color 0.3s;
      user-select: none;
      position: relative;
      overflow: visible;
    }
    
    .option:hover:not(.disabled):not(.answered-correct):not(.answered-incorrect) {
      background-color: #dceddb;
      border-color: #71b280;
    }
    
    .option.answered-correct {
      background-color: rgba(25, 135, 84, 0.25);
      border: 3px solid #198754;
      color: #0d4b21;
      font-weight: 700;
      cursor: default;
    }
    
    .option.answered-incorrect {
      background-color: rgba(220, 53, 69, 0.25);
      border: 3px solid #dc3545;
      color: #721c24;
      font-weight: 700;
      cursor: default;
    }
    
    .option.disabled {
      cursor: default;
      opacity: 0.8;
    }
    
    .answer-popup {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      display: flex;
      opacity: 0.95;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: 900;
      border-radius: 6px;
      z-index: 5;
      pointer-events: none;
      animation: popup-fade 1.2s forwards;
    }
    
    .answer-popup.correct {
      background-color: rgba(25, 135, 84, 0.25);
      color: #18763b;
    }
    
    .answer-popup.incorrect {
      background-color: rgba(220, 53, 69, 0.2);
      color: #b02a37;
    }
    
    @keyframes popup-fade {
      0% { opacity: 0; }
      10% { opacity: 1; }
      80% { opacity: 0.95; }
      100% { opacity: 0; }
    }
    
    .button-group {
      display: flex;
      gap: 14px;
      flex-wrap: wrap;
      margin-bottom: 8px;
    }
    
    .btn {
      padding: 11px 18px;
      border: none;
      border-radius: 7px;
      cursor: pointer;
      font-weight: 700;
      font-size: 15px;
      color: #f0f0f0;
      transition: background-color 0.3s ease;
    }
    
    .btn-answer {
      background-color: #198754;
    }
    
    .btn-answer:hover {
      background-color: #146c43;
    }
    
    .btn-copy {
      background-color: #0d6efd;
    }
    
    .btn-copy:hover {
      background-color: #084298;
    }
    
    .chatgpt-btn {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      margin-left: 8px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(116, 185, 255, 0.3);
    }
    
    .chatgpt-btn:hover {
      background: linear-gradient(135deg, #0984e3, #74b9ff);
    }
    
    .copy-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #00b894;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: 600;
      z-index: 10000;
      transform: translateX(100%);
      transition: transform 0.3s ease;
    }
    
    .copy-notification.show {
      transform: translateX(0);
    }
    
    .answer-reveal {
      display: none;
      margin-top: 14px;
      background: #c7ddfa;
      border: 2px solid #3b82f6;
      border-radius: 10px;
      color: #1e40af;
      padding: 14px 18px;
      font-weight: 700;
    }
    
    .tick-cross-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 80px;
      font-weight: 900;
      z-index: 1000;
      pointer-events: none;
      animation: tick-cross-fade 1.5s forwards;
    }
    
    .tick-cross-popup.correct {
      color: #198754;
    }
    
    .tick-cross-popup.incorrect {
      color: #dc3545;
    }
    
    @keyframes tick-cross-fade {
      0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.5);
      }
      20% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1.2);
      }
      40% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
      100% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(1);
      }
    }
    
    .no-questions {
      text-align: center;
      font-style: italic;
      color: #4a5768;
      font-size: 17px;
      padding: 48px 10px;
    }
    
    @media (max-width: 900px) {
      .controls {
        flex-direction: column;
        align-items: stretch;
      }
      
      .dropdown-group {
        min-width: unset;
        width: 100%;
      }
      
      .class-reload-group {
        min-width: unset;
        width: 100%;
        flex-direction: row;
      }
      
      .class-dropdown-part {
        flex: 1;
      }
      
      .reload-btn {
        margin-left: 8px;
        flex-shrink: 0;
      }
      
      .header h1 {
        padding-left: 8px;
        padding-right: 8px;
        margin-left: 0;
        max-width: 320px;
        white-space: normal;
      }
      
      .content-area {
        max-width: 100%;
        padding: 20px 16px;
        min-height: 300px;
      }
      
      .question-item {
        max-width: 100%;
        padding: 18px 12px;
      }
      
      .question-text {
        font-size: 15px;
      }
    }
  </style>
</head>
<body>

<div class="header" role="banner">
  <h1>NEET-PYQ</h1>
  <div class="subtitle">NEET/AIPMT Biology Section Wise Analysis (1988-2025)</div>
</div>

<div class="note" role="note">
  <em>Note: Some questions from a particular section may appear in subsequent sections if the concept spans multiple areas.</em>
</div>

<div class="controls" role="region" aria-label="Filtering controls">
  <div class="class-reload-group">
    <div class="class-dropdown-part">
      <label for="classSelect">Class:</label>
      <select id="classSelect" aria-controls="chapterSelect sectionSelect" onchange="updateChapters()" aria-required="true">
        <option value="">Select Class</option>
        <option value="11">Class 11</option>
        <option value="12">Class 12</option>
      </select>
    </div>
    <button id="reloadBtn" class="reload-btn" onclick="window.location.reload()">
      ðŸ”„ Reload
    </button>
  </div>

  <div class="dropdown-group">
    <label for="chapterSelect">Chapter:</label>
    <select id="chapterSelect" aria-controls="sectionSelect" onchange="updateSections()" disabled aria-required="true">
      <option value="">Select Chapter</option>
    </select>
  </div>

  <div class="dropdown-group">
    <label for="sectionSelect">Section:</label>
    <select id="sectionSelect" onchange="showQuestions()" disabled aria-required="true">
      <option value="">Select Section</option>
    </select>
  </div>

  <div id="scoreWrapper">
    <div id="scoreCard" class="scoreCard" aria-live="polite" role="region" aria-atomic="true" tabindex="0">
      Section score: x / y
    </div>
    <button id="refreshChapterBtn" class="refreshBtn" aria-label="Refresh section score">
      <span>ðŸ”„</span> Refresh
    </button>
  </div>
</div>

<main class="content-area" id="contentArea" role="main" tabindex="-1">
  <div class="no-questions">Please select Class, Chapter, and Section to view questions.</div>
</main>

<script>
// Question data structure (simplified for brevity)
const questionData = {
  "11": {
    "1": {
      "title": "The Living World",
      "sections": [
        {
          "id": "1.0",
          "name": "Introduction to Biology and Living Organisms"
        },
        {
          "id": "1.1", 
          "name": "Diversity in the Living World"
        },
        {
          "id": "1.2",
          "name": "Taxonomic Categories"
        }
      ],
      "questions": {}
    },
    "2": {
      "title": "Biological Classification",
      "sections": [
        {
          "id": "2.0",
          "name": "Evolution of Classification Systems"
        },
        {
          "id": "2.1",
          "name": "Kingdom Monera"
        }
      ],
      "questions": {
        "2.1": [
          {
            "year": "NEET/AIPMT 2019",
            "question": "Match Column I (groups) with Column II (typical habitats) and choose the correct option:<br><br>Column I: A) Halophiles &nbsp; B) Thermoacidophiles &nbsp; C) Methanogens &nbsp; D) Cyanobacteria<br>Column II: 1) Hot springs &nbsp; 2) Aquatic environment &nbsp; 3) Guts of ruminants &nbsp; 4) Salty area",
            "options": [
              "A-4, B-1, C-3, D-2",
              "A-1, B-2, C-3, D-4", 
              "A-3, B-4, C-2, D-1",
              "A-2, B-4, C-3, D-1"
            ],
            "answer": "A-4, B-1, C-3, D-2"
          },
          {
            "year": "NEET/AIPMT 2017",
            "question": "Which among the following are the smallest living cells, known without a definite cell wall, pathogenic to plants as well as animals and can survive without oxygen?",
            "options": [
              "Pseudomonas",
              "Mycoplasma",
              "Nostoc", 
              "Bacillus"
            ],
            "answer": "Mycoplasma"
          }
        ]
      }
    }
  }
};

let currentQuestions = [];
let sectionScores = {};
let questionStates = {};

// Copy to clipboard function
async function copyToClipboard(text) {
  try {
    await navigator.clipboard.writeText(text);
    return true;
  } catch (err) {
    const textArea = document.createElement('textarea');
    textArea.value = text;
    textArea.style.position = 'fixed';
    textArea.style.left = '-999999px';
    document.body.appendChild(textArea);
    textArea.select();
    const successful = document.execCommand('copy');
    document.body.removeChild(textArea);
    return successful;
  }
}

// Show copy notification
function showCopyNotification() {
  const existingNotification = document.querySelector('.copy-notification');
  if (existingNotification) existingNotification.remove();
  
  const notification = document.createElement('div');
  notification.className = 'copy-notification';
  notification.textContent = 'âœ“ Question copied for ChatGPT!';
  document.body.appendChild(notification);
  
  setTimeout(() => notification.classList.add('show'), 100);
  setTimeout(() => {
    notification.classList.remove('show');
    setTimeout(() => notification.remove(), 300);
  }, 3000);
}

// Build ChatGPT prompt using currentQuestions array (FIXED ROOT CAUSE)
function buildChatGPTPrompt(questionIndex) {
  if (!currentQuestions || !currentQuestions[questionIndex]) {
    return '';
  }

  const question = currentQuestions[questionIndex];
  let prompt = '';
  
  // Add question text (clean HTML tags)
  prompt += question.question.replace(/<[^>]*>/g, '') + '\n\n';
  
  // Add options A, B, C, D
  question.options.forEach((option, idx) => {
    const optionLetter = String.fromCharCode(65 + idx); // A, B, C, D
    prompt += optionLetter + ') ' + option + '\n';
  });

  // Add 3-version instruction
  prompt += '\nAnswer and Explain this question in 3 versions:\n';
  prompt += 'Version 1: brief explanation\n';
  prompt += 'Version 2: quote exact reference from NCERT biology text latest reprint and answer it accordingly\n';
  prompt += 'Version 3: detailed explanation with option analysis';

  return prompt;
}

function updateChapters() {
  const classValue = document.getElementById('classSelect').value;
  const chapterSelect = document.getElementById('chapterSelect');
  const sectionSelect = document.getElementById('sectionSelect');
  
  chapterSelect.innerHTML = '<option value="">Select Chapter</option>';
  sectionSelect.innerHTML = '<option value="">Select Section</option>';
  
  if (classValue && questionData[classValue]) {
    chapterSelect.disabled = false;
    Object.keys(questionData[classValue]).forEach(chapterKey => {
      const option = document.createElement('option');
      option.value = chapterKey;
      option.textContent = `Chapter ${chapterKey}: ${questionData[classValue][chapterKey].title}`;
      chapterSelect.appendChild(option);
    });
  } else {
    chapterSelect.disabled = true;
    sectionSelect.disabled = true;
    document.getElementById('contentArea').innerHTML = '<div class="no-questions">Please select Class, Chapter, and Section to view questions.</div>';
  }
  
  updateScoreDisplay();
}

function updateSections() {
  const classValue = document.getElementById('classSelect').value;
  const chapterValue = document.getElementById('chapterSelect').value;
  const sectionSelect = document.getElementById('sectionSelect');
  
  sectionSelect.innerHTML = '<option value="">Select Section</option>';
  
  if (classValue && chapterValue && questionData[classValue][chapterValue]) {
    sectionSelect.disabled = false;
    questionData[classValue][chapterValue].sections.forEach(section => {
      const option = document.createElement('option');
      option.value = section.id;
      option.textContent = `Section ${section.id}: ${section.name}`;
      sectionSelect.appendChild(option);
    });
  } else {
    sectionSelect.disabled = true;
    document.getElementById('contentArea').innerHTML = '<div class="no-questions">Please select Class, Chapter, and Section to view questions.</div>';
  }
  
  updateScoreDisplay();
}

function showQuestions() {
  const classValue = document.getElementById('classSelect').value;
  const chapterValue = document.getElementById('chapterSelect').value;
  const sectionValue = document.getElementById('sectionSelect').value;
  
  if (!classValue || !chapterValue || !sectionValue) {
    document.getElementById('contentArea').innerHTML = '<div class="no-questions">Please select Class, Chapter, and Section to view questions.</div>';
    return;
  }
  
  const questions = questionData[classValue]?.[chapterValue]?.questions?.[sectionValue];
  currentQuestions = questions;
  
  if (!questions || questions.length === 0) {
    document.getElementById('contentArea').innerHTML = '<div class="no-questions">No questions available for this section yet.</div>';
    updateScoreDisplay();
    return;
  }
  
  let html = `<div class="question-count">Questions found: ${questions.length}</div>`;
  
  questions.forEach((q, index) => {
    const questionId = `${classValue}-${chapterValue}-${sectionValue}-${index}`;
    const questionState = questionStates[questionId];
    
    html += `
      <div class="question-item">
        <div class="question-header">
          <div class="question-number">Q${index + 1}.</div>
          <div class="question-year">[${q.year}]</div>
        </div>
        <div class="question-text">${q.question}</div>
        <div class="options">
          ${q.options.map((option, optIndex) => {
            let optionClass = 'option';
            if (questionState) {
              if (questionState.selectedIndex === optIndex) {
                optionClass += questionState.isCorrect ? ' answered-correct' : ' answered-incorrect';
              } else if (questionState.selectedIndex !== null) {
                optionClass += ' disabled';
              }
            }
            return `<div class="${optionClass}" onclick="selectOption(${index}, ${optIndex}, '${q.answer}', '${questionId}')">${option}</div>`;
          }).join('')}
        </div>
        <div class="button-group">
          <button class="btn btn-answer" onclick="showAnswer(${index})">Show Answer</button>
          <button class="btn btn-copy" onclick="copyQuestion(${index})">Copy Question</button>
        </div>
        <div class="answer-reveal" id="answer-${index}">
          <strong>Correct Answer:</strong> ${q.answer}
        </div>
      </div>
    `;
  });
  
  document.getElementById('contentArea').innerHTML = html;
  updateScoreDisplay();
  
  // Add ChatGPT buttons after questions are loaded
  setTimeout(addChatGPTButtons, 100);
}

// Add ChatGPT button to each question (FIXED VERSION)
function addChatGPTButtons() {
  const questionItems = document.querySelectorAll('.question-item');
  
  questionItems.forEach((questionElement, index) => {
    const buttonGroup = questionElement.querySelector('.button-group');
    if (!buttonGroup) return;
    if (buttonGroup.querySelector('.chatgpt-btn')) return;

    const btn = document.createElement('button');
    btn.className = 'chatgpt-btn';
    btn.textContent = 'ChatGPT';

    btn.addEventListener('click', async () => {
      // Get FRESH prompt data using the question index
      const prompt = buildChatGPTPrompt(index);
      if (!prompt) {
        alert('Could not extract question content.');
        return;
      }
      
      // Copy to clipboard first
      const success = await copyToClipboard(prompt);
      
      if (success) {
        showCopyNotification();
        
        // Visual feedback
        const originalText = btn.textContent;
        btn.textContent = 'Copied!';
        btn.style.background = '#00b894';
        
        setTimeout(() => {
          btn.textContent = originalText;
          btn.style.background = 'linear-gradient(135deg, #74b9ff, #0984e3)';
        }, 1500);
        
        // Open ChatGPT
        window.open('https://chat.openai.com/', '_blank');
      } else {
        alert('Failed to copy. Please try again.');
      }
    });

    buttonGroup.appendChild(btn);
  });
}

function selectOption(questionIndex, optionIndex, correctAnswer, questionId) {
  if (questionStates[questionId]) return;
  
  const selectedOption = currentQuestions[questionIndex].options[optionIndex];
  const isCorrect = selectedOption === correctAnswer;
  
  questionStates[questionId] = {
    selectedIndex: optionIndex,
    isCorrect: isCorrect
  };
  
  const options = document.querySelectorAll(`.question-item:nth-child(${questionIndex + 2}) .option`);
  options.forEach((option, index) => {
    if (index === optionIndex) {
      option.classList.add(isCorrect ? 'answered-correct' : 'answered-incorrect');
    } else {
      option.classList.add('disabled');
    }
  });
  
  const clickedOption = options[optionIndex];
  const popup = document.createElement('div');
  popup.className = `answer-popup ${isCorrect ? 'correct' : 'incorrect'}`;
  popup.textContent = isCorrect ? 'âœ“' : 'âœ—';
  clickedOption.appendChild(popup);
  
  setTimeout(() => {
    if (clickedOption.contains(popup)) {
      clickedOption.removeChild(popup);
    }
  }, 1200);
  
  const tickCrossPopup = document.createElement('div');
  tickCrossPopup.className = `tick-cross-popup ${isCorrect ? 'correct' : 'incorrect'}`;
  tickCrossPopup.textContent = isCorrect ? 'âœ“' : 'âœ—';
  document.body.appendChild(tickCrossPopup);
  
  setTimeout(() => {
    document.body.removeChild(tickCrossPopup);
  }, 1500);
  
  updateScoreForSection();
  updateScoreDisplay();
}

function updateScoreForSection() {
  const classValue = document.getElementById('classSelect').value;
  const chapterValue = document.getElementById('chapterSelect').value;
  const sectionValue = document.getElementById('sectionSelect').value;
  
  if (!classValue || !chapterValue || !sectionValue) return;
  
  const sectionKey = `${classValue}-${chapterValue}-${sectionValue}`;
  let correct = 0;
  let answered = 0;
  
  currentQuestions.forEach((q, index) => {
    const questionId = `${classValue}-${chapterValue}-${sectionValue}-${index}`;
    const questionState = questionStates[questionId];
    if (questionState) {
      answered++;
      if (questionState.isCorrect) {
        correct++;
      }
    }
  });
  
  sectionScores[sectionKey] = {
    correct,
    answered,
    total: currentQuestions.length
  };
}

function updateScoreDisplay() {
  const classValue = document.getElementById('classSelect').value;
  const chapterValue = document.getElementById('chapterSelect').value;
  const sectionValue = document.getElementById('sectionSelect').value;
  
  if (!classValue || !chapterValue || !sectionValue) {
    document.getElementById('scoreCard').textContent = 'Section score: x / y';
    return;
  }
  
  const sectionKey = `${classValue}-${chapterValue}-${sectionValue}`;
  const score = sectionScores[sectionKey] || { correct: 0, answered: 0, total: currentQuestions.length || 0 };
  
  document.getElementById('scoreCard').textContent = `Section score: ${score.correct} / ${score.total}`;
}

function showAnswer(index) {
  const answerDiv = document.getElementById(`answer-${index}`);
  answerDiv.style.display = answerDiv.style.display === 'block' ? 'none' : 'block';
}

function copyQuestion(index) {
  const question = currentQuestions[index];
  const text = question.question + '\n' + question.options.join('\n') + '\nAnswer: ' + question.answer;
  
  navigator.clipboard.writeText(text).then(() => {
    alert('Question copied to clipboard!');
  });
}

// Refresh button functionality
document.getElementById('refreshChapterBtn').addEventListener('click', function() {
  const classValue = document.getElementById('classSelect').value;
  const chapterValue = document.getElementById('chapterSelect').value;
  const sectionValue = document.getElementById('sectionSelect').value;
  
  if (!classValue || !chapterValue || !sectionValue) return;
  
  const sectionKey = `${classValue}-${chapterValue}-${sectionValue}`;
  Object.keys(questionStates).forEach(key => {
    if (key.startsWith(`${classValue}-${chapterValue}-${sectionValue}-`)) {
      delete questionStates[key];
    }
  });
  
  delete sectionScores[sectionKey];
  showQuestions();
  updateScoreDisplay();
});

// Initialize
updateChapters();
</script>
<!-- Add this CSS before </head> tag -->
<style>
.chatgpt-btn {
  background: linear-gradient(135deg, #74b9ff, #0984e3);
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 8px;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  margin-left: 8px;
  transition: all 0.3s ease;
  box-shadow: 0 2px 8px rgba(116, 185, 255, 0.3);
}

.chatgpt-btn:hover {
  background: linear-gradient(135deg, #0984e3, #74b9ff);
}

.copy-notification {
  position: fixed;
  top: 20px;
  right: 20px;
  background: #00b894;
  color: white;
  padding: 12px 20px;
  border-radius: 8px;
  font-weight: 600;
  z-index: 10000;
  transform: translateX(100%);
  transition: transform 0.3s ease;
}

.copy-notification.show {
  transform: translateX(0);
}
</style>

<!-- Add this JavaScript before </body> tag -->
<script>
// Copy to clipboard function
async function copyToClipboard(text) {
  try {
    await navigator.clipboard.writeText(text);
    return true;
  } catch (err) {
    const textArea = document.createElement('textarea');
    textArea.value = text;
    textArea.style.position = 'fixed';
    textArea.style.left = '-999999px';
    document.body.appendChild(textArea);
    textArea.select();
    const successful = document.execCommand('copy');
    document.body.removeChild(textArea);
    return successful;
  }
}

// Show copy notification
function showCopyNotification() {
  const existingNotification = document.querySelector('.copy-notification');
  if (existingNotification) existingNotification.remove();
  
  const notification = document.createElement('div');
  notification.className = 'copy-notification';
  notification.textContent = 'âœ“ Question copied to clipboard!';
  document.body.appendChild(notification);
  
  setTimeout(() => notification.classList.add('show'), 100);
  setTimeout(() => {
    notification.classList.remove('show');
    setTimeout(() => notification.remove(), 300);
  }, 3000);
}

// Build ChatGPT prompt using currentQuestions array
function buildChatGPTPrompt(questionIndex) {
  if (!currentQuestions || !currentQuestions[questionIndex]) {
    return '';
  }

  const question = currentQuestions[questionIndex];
  let prompt = '';
  
  // Add question text (strip HTML tags)
  prompt += question.question.replace(/<[^>]*>/g, '').replace(/&nbsp;/g, ' ') + '

';
  
  // Add options A, B, C, D
  question.options.forEach((option, idx) => {
    const optionLetter = String.fromCharCode(65 + idx); // A, B, C, D
    prompt += optionLetter + ') ' + option.replace(/^[a-d])s*/, '') + '
';
  });

  // Add your 3-version instruction
  prompt += '
Answer and Explain this question in 3 versions:
';
  prompt += 'Version 1: brief explanation
';
  prompt += 'Version 2: quote exact reference from NCERT biology text latest reprint and answer it accordingly
';
  prompt += 'Version 3: detailed explanation with option analysis';

  return prompt;
}

// Add ChatGPT buttons to each question
function addChatGPTButtons() {
  const questionItems = document.querySelectorAll('.question-item');
  
  questionItems.forEach((questionElement, index) => {
    const buttonGroup = questionElement.querySelector('.button-group');
    if (!buttonGroup) return;
    if (buttonGroup.querySelector('.chatgpt-btn')) return;

    const btn = document.createElement('button');
    btn.className = 'chatgpt-btn';
    btn.textContent = 'ChatGPT';

    btn.addEventListener('click', async () => {
      const prompt = buildChatGPTPrompt(index);
      if (!prompt) {
        alert('Could not extract question content.');
        return;
      }
      
      // Copy to clipboard
      const success = await copyToClipboard(prompt);
      
      if (success) {
        showCopyNotification();
        
        // Visual feedback on button
        const originalText = btn.textContent;
        btn.textContent = 'Copied!';
        btn.style.background = '#00b894';
        
        setTimeout(() => {
          btn.textContent = originalText;
          btn.style.background = 'linear-gradient(135deg, #74b9ff, #0984e3)';
        }, 1500);
      } else {
        alert('Failed to copy. Please try again.');
      }
    });

    buttonGroup.appendChild(btn);
  });
}

// Override showQuestions to add ChatGPT buttons after questions load
const originalShowQuestions = window.showQuestions;
window.showQuestions = function() {
  originalShowQuestions.apply(this, arguments);
  setTimeout(addChatGPTButtons, 100);
};

// Initialize on page load
document.addEventListener('DOMContentLoaded', addChatGPTButtons);
</script>

</body>
</html>
