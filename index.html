<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NEET-PYQ Test</title>
<style>
  body { font-family: Arial, sans-serif; margin: 24px; background:#f8fafc; color:#344050; }
  header { background:#0f172a; padding:40px; border-radius:12px; color:#ffcc55; }
  h1 { font-weight:900; margin:0 0 12px; }
  .controls { display:flex; gap:20px; flex-wrap:wrap; margin-bottom:24px; }
  .controls > div { flex:1; min-width:180px; }
  select { width:100%; padding:10px; font-size:16px; border:2px solid #028090; border-radius:9px; }
  select:disabled { background:#e5e7eb; }
  button { padding:8px 12px; border:none; border-radius:6px; background:#2dd4bf; color:#172c66; cursor:pointer; }
  button:focus { outline:3px solid #0f172a; outline-offset:2px; }
  .question { background:#fff; border-radius:10px; padding:20px; margin-bottom:28px; box-shadow: 0 0 8px #ccc; }
  .question h3 { margin-top:0; }
  .option { background:#e0f2f1; padding:12px 16px; border-radius:8px; margin:9px 0; cursor:pointer; position:relative; }
  .option:hover { background:#b2dfdb; }
  .option.disabled { pointer-events:none; opacity:0.7; cursor:default; }
  .option.correct { background:#d1fae5; border:2px solid #10b981; color:#065f46; }
  .option.wrong { background:#fee2e2; border:2px solid #ef4444; color:#991b1b; }
  .score { font-weight:700; font-size:18px; margin-bottom:20px; padding-left:10px; border-left:4px solid #028090; color:#065f46; }
</style>
</head>
<body>
<header>
  <h1>NEET-PYQ Test</h1>
  <p>Biology NEET section-wise question bank test</p>
</header>

<div class="controls" aria-label="Controls for filtering questions">
  <div>
    <label for="classSelect">Class</label>
    <select id="classSelect" aria-controls="chapterSelect sectionSelect" aria-required="true">
      <option value="">Select Class</option>
      <option value="11">Class 11</option>
      <option value="12">Class 12</option>
    </select>
  </div>
  <div>
    <label for="chapterSelect">Chapter</label>
    <select id="chapterSelect" disabled aria-required="true" aria-controls="sectionSelect">
      <option value="">Select Chapter</option>
    </select>
  </div>
  <div>
    <label for="sectionSelect">Section</label>
    <select id="sectionSelect" disabled aria-required="true">
      <option value="">Select Section</option>
    </select>
  </div>
  <div>
    <button id="refreshBtn" aria-label="Refresh current section questions">Refresh</button>
  </div>
</div>

<div id="scoreDisplay" class="score" aria-live="polite" aria-atomic="true">Score: 0 / 0</div>

<main id="contentArea" role="main" aria-live="polite" aria-atomic="true" tabindex="-1">
  Please select Class → Chapter → Section to view questions.
</main>

<script>
  // Core questionData initialization (empty sections/questions for 2)
  const questionData = {
    "11": {
      "2": {
        title: "Biological Classification",
        sections: [], // will be registered by addon
        questions: {}
      }
    }
  };
  const classSelect = document.getElementById("classSelect");
  const chapterSelect = document.getElementById("chapterSelect");
  const sectionSelect = document.getElementById("sectionSelect");
  const contentArea = document.getElementById("contentArea");
  const scoreDisplay = document.getElementById("scoreDisplay");
  const refreshBtn = document.getElementById("refreshBtn");

  let persisted = JSON.parse(localStorage.getItem("neetchoices_v3") || "{}");

  function clearDropdown(ele, disable = false) {
    ele.innerHTML = `<option value="">Select ${ele.id.replace("Select", "")}</option>`;
    if (disable) ele.disabled = true;
  }
  function clearContent() {
    contentArea.innerHTML = "Please select Class → Chapter → Section to view questions.";
    scoreDisplay.textContent = "Score: 0 / 0";
  }
  function updateChapters() {
    clearDropdown(chapterSelect);
    clearDropdown(sectionSelect, true);
    clearContent();
    if (!classSelect.value) return;
    const chs = Object.entries(questionData[classSelect.value] || {});
    chs.forEach(([k, v]) => {
      const opt = document.createElement("option");
      opt.value = k;
      opt.textContent = `Chapter ${k}: ${v.title}`;
      chapterSelect.appendChild(opt);
    });
    chapterSelect.disabled = false;
  }
  function updateSections() {
    clearDropdown(sectionSelect);
    clearContent();
    if (!classSelect.value || !chapterSelect.value) return;
    const chObj = questionData[classSelect.value]?.[chapterSelect.value];
    if (!chObj || !chObj.sections) return;
    chObj.sections.forEach((s) => {
      const opt = document.createElement("option");
      opt.value = s.id;
      opt.textContent = `${s.id}: ${s.name}`;
      sectionSelect.appendChild(opt);
    });
    sectionSelect.disabled = false;
    if (chObj.sections.length > 0) {
      sectionSelect.selectedIndex = 0;
      showQuestions();
    }
  }
  function registerOptionsEventHandlers() {
    document.querySelectorAll(".option").forEach((opt) => {
      opt.onclick = handleOptionClick;
      opt.onkeypress = (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          handleOptionClick(e);
        }
      };
    });
  }
  function handleOptionClick(e) {
    const opt = e.currentTarget;
    const qId = +opt.closest(".question").dataset.qnum;
    if (!qId) return;
    if (opt.classList.contains("disabled")) return;
    const container = opt.parentElement;
    container.querySelectorAll(".option").forEach((o) => {
      o.classList.add("disabled");
      o.style.pointerEvents = "none";
      o.tabIndex = -1;
      o.classList.remove("correct", "wrong");
    });
    const correctAnswer = container.dataset.correct.toLowerCase().trim();
    const selectedText = opt.textContent.toLowerCase().trim();
    const isCorrect = selectedText === correctAnswer;
    if (isCorrect) {
      opt.classList.add("correct");
    } else {
      opt.classList.add("wrong");
    }
    const sectionKey = `${classSelect.value}_${chapterSelect.value}_${sectionSelect.value}`;
    persisted[sectionKey] = persisted[sectionKey] || {};
    persisted[sectionKey][qId] = { selected: opt.dataset.index, correct: isCorrect };
    localStorage.setItem("neetchoices_v3", JSON.stringify(persisted));
    updateScore();
  }
  function repaintPersistentChoices() {
    const sectionKey = `${classSelect.value}_${chapterSelect.value}_${sectionSelect.value}`;
    const sel = persisted[sectionKey] || {};
    Object.entries(sel).forEach(([qIdStr, data]) => {
      const qId = +qIdStr;
      const container = document.querySelector(`.question[data-qnum="${qId}"] .options`);
      if (!container) return;
      container.querySelectorAll(".option").forEach((opt) => {
        opt.classList.add("disabled");
        opt.style.pointerEvents = "none";
        opt.tabIndex = -1;
        opt.classList.remove("correct", "wrong");
        if (+opt.dataset.index === +data.selected) {
          opt.classList.add(data.correct ? "correct" : "wrong");
        }
      });
    });
  }
  function updateScore() {
    const sectionKey = `${classSelect.value}_${chapterSelect.value}_${sectionSelect.value}`;
    const sel = persisted[sectionKey] || {};
    const total =
      questionData[classSelect.value]?.[chapterSelect.value]?.questions?.[
        sectionSelect.value
      ]?.length || 0;
    let corrects = Object.values(sel).filter((x) => x.correct).length;
    scoreDisplay.textContent = `Score: ${corrects} / ${total}`;
  }
  function showQuestions() {
    clearContent();
    if (!classSelect.value || !chapterSelect.value || !sectionSelect.value) return;
    const questions =
      questionData[classSelect.value]?.[chapterSelect.value]?.questions?.[
        sectionSelect.value
      ] || [];
    if (questions.length === 0) {
      contentArea.innerHTML = "<p>No questions found in this section.</p>";
      scoreDisplay.textContent = "Score: 0 / 0";
      return;
    }
    let html = "";
    questions.forEach((q, i) => {
      const qnum = i + 1;
      html += `<div class="question" data-qnum="${qnum}">
        <h3>Q${qnum}. [${q.year}]</h3>
        <div class="question-text">${q.question}</div>
        <div class="options" data-correct="${q.answer.trim()}">`;
      q.options.forEach((opt, idx) => {
        html += `<div class="option" data-index="${idx}" role="button" tabindex="0">${opt}</div>`;
      });
      html += `</div></div>`;
    });
    contentArea.innerHTML = html;
    registerOptionsEventHandlers();
    repaintPersistentChoices();
    updateScore();
  }
  classSelect.addEventListener("change", () => {
    updateChapters();
    clearContent();
  });
  chapterSelect.addEventListener("change", () => {
    updateSections();
    clearContent();
  });
  sectionSelect.addEventListener("change", () => {
    showQuestions();
  });
  refreshBtn.addEventListener("click", () => {
    const sectionKey = `${classSelect.value}_${chapterSelect.value}_${sectionSelect.value}`;
    delete persisted[sectionKey];
    localStorage.setItem("neetchoices_v3", JSON.stringify(persisted));
    showQuestions();
  });
</script>

<script>
  (function () {
    function bindSafeEvents() {
      const cs = document.getElementById("classSelect");
      const chs = document.getElementById("chapterSelect");
      const ss = document.getElementById("sectionSelect");
      if (cs && !cs._bound) {
        cs.addEventListener("change", () => {
          if (typeof updateChapters === "function") updateChapters();
        });
        cs._bound = true;
      }
      if (chs && !chs._bound) {
        chs.addEventListener("change", () => {
          if (typeof updateSections === "function") updateSections();
        });
        chs._bound = true;
      }
      if (ss && !ss._bound) {
        ss.addEventListener("change", () => {
          if (typeof showQuestions === "function") showQuestions();
        });
        ss._bound = true;
      }
    }
    function registerSectionIfMissing(c, ch, sectionId, displayName) {
      if (
        !window.questionData ||
        !questionData[c] ||
        !questionData[c][ch]
      )
        return;
      if (!Array.isArray(questionData[c][ch].sections))
        questionData[c][ch].sections = [];
      const exists = questionData[c][ch].sections.some(
        (s) => s && s.id === sectionId
      );
      if (!exists) {
        questionData[c][ch].sections.push({
          id: sectionId,
          name: displayName || `Section ${sectionId}`,
        });
      }
    }
    function ensureSectionVisible(c, ch, sectionId, displayName) {
      registerSectionIfMissing(c, ch, sectionId, displayName);
      const cs = document.getElementById("classSelect");
      const chs = document.getElementById("chapterSelect");
      const ss = document.getElementById("sectionSelect");
      if (
        cs &&
        chs &&
        ss &&
        typeof updateSections === "function"
      ) {
        if (cs.value === String(c) && chs.value === String(ch)) {
          updateSections();
          const opt = Array.from(ss.options).find(o => o.value === sectionId);
          if (opt) ss.value = sectionId;
          if (typeof showQuestions === "function") setTimeout(showQuestions, 0);
        }
      }
    }
    window.__ensureSectionVisible =
      window.__ensureSectionVisible || ensureSectionVisible;
    window.__ensureSectionVisibleAfterInjection =
      window.__ensureSectionVisibleAfterInjection || ensureSectionVisible;
    function forceInitialRefresh() {
      bindSafeEvents();
      const cs = document.getElementById("classSelect");
      const chs = document.getElementById("chapterSelect");
      const ss = document.getElementById("sectionSelect");
      if (cs && cs.value && typeof updateChapters === "function")
        updateChapters();
      if (chs && chs.value && typeof updateSections === "function")
        updateSections();
      if (ss && ss.value && typeof showQuestions === "function")
        showQuestions();
    }
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", () => {
        bindSafeEvents();
        forceInitialRefresh();
      }, { once: true });
    } else {
      bindSafeEvents();
      forceInitialRefresh();
    }
  })();
</script>

<script>
  (function () {
    const c = "11";
    const ch = "2";
    const section = "2.0";
    const sectionName = "Evolution of Classification Systems";

    const items = [
      {
        year: "NEET 2014",
        question:
          "Five kingdom system of classification suggested by R. H. Whittaker is NOT based on which of the following criteria?",
        options: [
          "a) Presence or absence of a well-defined nucleus",
          "b) Mode of reproduction",
          "c) Mode of nutrition",
          "d) Complexity of body organisation",
        ],
        answer: "b) Mode of reproduction",
      },
      {
        year: "NEET 2012",
        question:
          "In the five kingdom classification, Chlamydomonas and Chlorella have been included in which kingdom?",
        options: ["a) Protista", "b) Algae", "c) Plantae", "d) Monera"],
        answer: "a) Protista",
      },
    ];

    function inject() {
      if (!window.questionData) return;
      if (!questionData[c]) questionData[c] = {};
      if (!questionData[c][ch])
        questionData[c][ch] = { sections: [], questions: {} };
      if (!questionData[c][ch].questions) questionData[c][ch].questions = {};

      questionData[c][ch].questions[section] = items;

      if (!questionData[c][ch].sections.find((s) => s.id === section)) {
        questionData[c][ch].sections.push({ id: section, name: sectionName });
      }

      if (typeof updateChapters === "function") {
        updateChapters();
      }
      if (chapterSelect) {
        chapterSelect.value = ch;
      }
      if (typeof updateSections === "function") {
        updateSections();
      }
      if (sectionSelect) {
        sectionSelect.value = section;
      }
      if (typeof showQuestions === "function") {
        showQuestions();
      }
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", inject);
    } else {
      inject();
    }
  })();
</script>
</body>
</html>
